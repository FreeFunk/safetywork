<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>秦皇岛市智慧交通北斗大数据分析平台</title>
<link href="css/animate.min.css" rel="stylesheet" type="text/css">
<link href="css/layout.css" rel="stylesheet" type="text/css" />
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="font/iconfont.css" rel="stylesheet" type="text/css" />
<link href="css/layer-animate.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="css/datedropper.css">
<link rel="stylesheet" type="text/css" href="css/timedropper.min.css">
    <script type="text/javascript" src="js/laydate/laydate.js"></script>
    <script src="js/layer/layer.js"></script>
    <script src="js/tool.js"></script>
</head>

<body style="overflow: scroll;height: 100%;">
<style type="text/css">
 .laywindow{
     background-color: #07304c;
 }
</style>
<div class="main">
      <div class="ind">
        <div style="width:64%; float: left">
           <div style="width:38%; float: left">
                       <div class="mk" >
                               <em class="b1"></em><em class="b2"></em><em class="b3"></em><em class="b4"></em><em class="mid"></em>
                               <div class="tit0" style="height: 13px;">
                                     <span class="tit0_l"></span>
                                     <span class="tit0_m" style="font-size: 14px;">车辆信息</span>
                                     <span class="tit0_r"></span>
                               </div>
                           <div class="con0 clearfix">
                  <div class="clxx0">
                      <input type="hidden" id="id" />
                     <ul>
                        <li>
                           <div class="clxx0_m" >车牌号:</div>
                           <div id="carPlateNum" class="clxx0_r"></div>
                        </li>
                         <li>
                           <div class="clxx0_m">车牌颜色:</div>
                           <div id="carPlateColor" class="clxx0_r"></div>
                        </li>
                         <li>
                           <div class="clxx0_m" >许可证号:</div>
                           <div id="jyCertNumber" class="clxx0_r" s></div>
                        </li>
                         <li>
                             <div class="clxx0_m" >所属企业:</div>
                             <div id="ownerTeamName" class="clxx0_r"></div>
                         </li>
                         <li>
                           <div class="clxx0_m" >业户名称:</div>
                           <div id="contactPerson" class="clxx0_r"></div>
                        </li>
                         <li>
                           <div class="clxx0_m" >车辆类型:</div>
                           <div id="carFunType" class="clxx0_r"></div>
                        </li>
                        <li>
                           <div class="clxx0_m" >行驶状态:</div>
                           <div id="runState" class="clxx0_r" >暂无信息</div>
                        </li>
                        <li>
                           <div class="clxx0_m">所属县区:</div>
                           <div id="locationInfo" class="clxx0_r">暂无信息</div>
                        </li>
                        <li style="display: none">
                           <div class="clxx0_m" >车架号:</div>
                           <div id="carFrameNum" class="clxx0_r" ></div>
                        </li>
                         <li>
                             <div class="clxx0_m" >年审截止时间:</div>
                             <div id="nianshenDate" class="clxx0_r" ></div>
                         </li>
                        <li>
                           <div class="clxx0_m">道路运输证号:</div>
                           <div id="transitLicenceCode" class="clxx0_r">暂无信息</div>
                        </li>
                        <li>
                           <div class="clxx0_m">联系电话:</div>
                           <div id="contactPhone" class="clxx0_r"></div>
                        </li>
                        <li>
                           <div class="clxx0_m">北斗运营商:</div>
                           <div id="beidouOraComp" class="clxx0_r">暂无信息</div>
                        </li>
                        <li>
                           <div class="clxx0_m">车辆品牌:</div>
                           <div id="carBrandsName" class="clxx0_r">&nbsp;</div>
                        </li>
                         <!--<li>-->
                           <!--<div class="clxx0_m"style="font-size: 14px;text-align: center;">地理位置:</div>-->
                           <!--<div class="clxx0_r"style="font-size: 14px;"><a href="#" >查看位置</a></div>-->
                        <!--</li>-->
                        
                     </ul>
                  </div>
               </div>
                        </div> 
               
               
               <div class="blank10"></div>
               
                <div class="mk" >
                               <em class="b1"></em><em class="b2"></em><em class="b3"></em><em class="b4"></em><em class="mid"></em>
                               <div class="tit0" style="height: 6px">
                                     <span class="tit0_l"></span>
                                     <span class="tit0_m" style="font-size: 14px">关联人员</span>
                                     <span class="tit0_r"></span>
                               </div>
                    <div class="blank10"></div>
                   <div class="con0 clearfix" style="height:260px; overflow-y: scroll">
                       <table id="empList" width="100%" class="grid03">
                          <tr>
                            <th style="width:30%">姓名</th>
                            <th style="width:40%">时间</th>
                            <th style="width:30%">身份</th>
                          </tr>
                       </table>
                   </div>
                    <div class="blank10"></div>
               </div>
           </div>
            <div style="width:61%; float: right">
                       <div class="mk" style="height: 405px">
                               <em class="b1"></em><em class="b2"></em><em class="b3"></em><em class="b4"></em><em class="mid"></em>
                               <div class="tit0" >
                                     <span class="tit0_l" style="margin-left:7px;"></span>
                                     <span class="tit0_m" style="font-size: 14px">危险驾驶信息</span>
                                     <span class="tit0_r"></span>
                                   <input type="text" class="input_rl " onclick="selctTime()" id="searchDate" style="width:110px; height: 30px; margin-left: 245px; ">
                               </div>
                              <!-- <div class="blank10"></div>-->
                                   <div class="con0 clearfix" style="height: 300px;overflow-y: scroll">
                                        <table id="peccancyList" width="100%" class="grid03">
                                          <!--<tr>
                                            &lt;!&ndash;<th style="width:15%">司机</th>&ndash;&gt;
                                            <th style="width:25%">违章时间</th>
                                            <th style="width:15%">司机姓名</th>
                                            <th style="width:20%">违章类型</th>
                                            <th style="width:20%">处理结果</th>
                                            &lt;!&ndash;<th style="width:20%">详情</th>&ndash;&gt;
                                          </tr>-->
                                       </table>
                                   </div>
                                <div class="blank10"></div>
                        </div> 
                
                       <div class="blank10"></div>
                
                        <div class="mk" >
                               <em class="b1"></em><em class="b2"></em><em class="b3"></em><em class="b4"></em><em class="mid"></em>
                               <div class="blank20"></div>
                                   <div class="con0 clearfix" style="position:relative">
                                        <span id="carPNum" class="cph00" style="font-size: 14px;height: 37px;"></span>
                                        <img id="carPhoto" src="" style="width: 100%; height: 270px">
                                   </div>
                                <div class="blank20"></div>
                        </div>
           </div> 
            
            
            <div class="blank10"></div>
        </div>
          <div style="width:35%; float: right">
                           <div class=" mk"  style="position: relative">
                              <em class="b1"></em><em class="b2"></em><em class="b3"></em><em class="b4"></em><em class="mid"></em>
                               <div class="tit0" style="margin-right: 57px;height: 10px;">
                                     <span class="tit0_l"></span>
                                     <span class="tit0_m"style="font-size: 14px">里程分析</span>
                                     <span class="tit0_r"></span>
                               </div>
                                     <div class="time0 clearfix" style=" position: absolute; right:5px; top: 5px;">
                                            <div class="btn-group year_group ">
                                                <button data-toggle="dropdown" class="dropdown-toggle" type="button" style="padding: 2px 3px !important;">
                                                    <span id="year">本周</span><i class="caret"></i>
                                                </button>
                                                <ul class="dropdown-menu">
                                                  <li><a href="javaScript:void(0);" onclick="searchMonth('WEEK','mileage')">本周</a></li>
                                                  <li><a href="javaScript:void(0);" onclick="searchMonth('MONTH','mileage')">本月</a></li>
                                                  <li><a href="javaScript:void(0);" onclick="searchMonth('PRE_MONTH','mileage')">上月</a></li>
                                                </ul>
                                            </div>
                                          </div>
                                <div class="blank10"></div>
                                <Div class="con0 clearfix">
                                   <div style=" width:100%;height:162px" id="aa1"></div>
                                </Div>
                               <div class="blank10"></div>
                         </div>
              
              <div class="blank10"></div>
              
                        <div class=" mk" style="position: relative">
                               <em class="b1"></em><em class="b2"></em><em class="b3"></em><em class="b4"></em><em class="mid"></em>
                               <div class="tit0" style="margin-right: 57px;height: 10px;">
                                     <span class="tit0_l"></span>
                                     <span class="tit0_m"style="font-size: 14px">速度分析</span>
                                     <span class="tit0_r"></span>
                               </div>
                               <div class="time0 clearfix" style=" position: absolute; right:5px; top: 5px;">
                                            <div class="btn-group year_group ">
                                                <button data-toggle="dropdown" class="dropdown-toggle" type="button" style="padding: 2px 3px !important;">
                                                    <span id="year">本周</span><i class="caret"></i>
                                                </button>
                                                <ul class="dropdown-menu">
                                                  <li><a href="javaScript:void(0);" onclick="searchMonth('WEEK','speed')">本周</a></li>
                                                  <li><a href="javaScript:void(0);" onclick="searchMonth('MONTH','speed')">本月</a></li>
                                                  <li><a href="javaScript:void(0);" onclick="searchMonth('PRE_MONTH','speed')">上月</a></li>
                                                </ul>
                                            </div>
                                          </div>
                                <div class="blank10"></div>
                                <Div class="con0 clearfix">
                                   <div style=" width:100%;height:120px" id="aa2"></div>
                                </Div>
                               <div class="blank10"></div>
                         </div>
           
           
               <div class="blank10"></div>
              
              
              <div class=" mk" style="height:312px" >
                               <em class="b1"></em><em class="b2"></em><em class="b3"></em><em class="b4"></em><em class="mid"></em>
                               <div class="tit0" style="height: 10px;">
                                     <span class="tit0_l"></span>
                                     <span class="tit0_m"style="font-size: 14px">常跑路线</span>
                                     <span class="tit0_r"></span>
                               </div>

                                <div class="blank10"></div>
                                <Div class="con0 clearfix">
                                      <div class="tablebox1" style="overflow-y: scroll;height: 400px">
                        <table id="tableId1" border="0" cellspacing="0" cellpadding="0"  >
                            <thead>
                                <tr>
                                    <th style="width: 15%">排名</th>
                                    <th style="width: 70%">路线</th>
                                   <!-- <th style="width: 25%">总里程</th>-->
                                    <th style="width: 15%">次数</th>
                                </tr>
                            </thead>
                            <tbody>

                            </tbody>
                        </table>
                      </div>
                </Div>

              <!--<Div id="con1" style="display: none">
                  <table id="recordAndPlan" width="100%" class="grid03" style="width: 96%;margin-left: 2%;">

                  </table>
              </Div>-->

              <div id="con1" class="mk" style="display: none">
                  <em class="b1"></em><em class="b2"></em><em class="b3"></em><em class="b4"></em><em class="mid"></em>
                  <div class="tit0">
                      <span class="tit0_l"></span>
                      <span class="tit0_m" id="title"></span>
                      <span class="tit0_r"></span>
                  </div>
                  <div class="blank10"></div>
                  <div class="con0 clearfix" style="height:630px; overflow-y: scroll">
                      <table id="recordAndPlan" width="100%" class="grid03">
                      </table>
                  </div>
              </div>

               <div class="blank10"></div>
              </div>
      </div> 
</div>

<script src="js/jquery-1.8.3.min.js"></script>
<script src="js/jquery-migrate-1.2.1.min.js"></script>
<script src="js/echarts.min.js"></script>
<script src="js/tool.js"></script>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
    
<script src="js/datedropper.min.js"></script>
<script src="js/timedropper.min.js"></script>
<script src="layer/layer.js"></script>
<script src="../../../../layuiadmin/layui/layui.js"></script>
<script>
$("#pickdate").dateDropper({
	animate: false,
	format: 'Y-m-d',
	maxYear: '2020'
});

  setValueCarInfo = function(transitCarBaseinfo,weiXianJiaShi,guangLianRenYuan,changPaoLuXian){
                 //         保存车辆id
                $("#id").val(transitCarBaseinfo.id);
                $("#carPlateNum").html(transitCarBaseinfo.carPlateNum);
                $("#carFrameNum").html(transitCarBaseinfo.carFrameNum);
                if(transitCarBaseinfo.carPlateColor==1){
                    $("#carPlateColor").html('蓝色');
                }else  if(transitCarBaseinfo.carPlateColor==2){
                    $("#carPlateColor").html('黄色');
                }

                $("#jyCertNumber").html(transitCarBaseinfo.jyCertNumber);
                var htmlToYh  = "";
                if(typeof (transitCarBaseinfo.ownerCarTeamName)=='undefined'){
                    htmlToYh = "暂无";
                }else {
                    htmlToYh = "<a href='#' >"+transitCarBaseinfo.ownerCarTeamName+"</a>";
                }
                $("#ownerTeamName").html(htmlToYh);
                $("#contactPerson").html(transitCarBaseinfo.contactPerson);
                debugger;
                if(transitCarBaseinfo.carFunType != null && transitCarBaseinfo.carFunType != ''){
                    $("#carFunType").html(getCarFunType(transitCarBaseinfo.carFunType));
                }else{
                    $("#carFunType").html("未知");
                }
                $("#runState").html(transitCarBaseinfo.runState);
                $("#locationInfo").html(transitCarBaseinfo.xianquName);
                if(typeof (transitCarBaseinfo.operatingStopDate)=='undefined'){
                    $("#nianshenDate").html();
                }else {
                    $("#nianshenDate").html(transitCarBaseinfo.operatingStopDate.substring(0,11));
                }
                $("#transitLicenceCode").html(transitCarBaseinfo.transitLicenceNum);
                $("#contactPhone").html(transitCarBaseinfo.contactPhone);
                $("#beidouOraComp").html(transitCarBaseinfo.beidouCompName);
                $("#carBrandsName").html(transitCarBaseinfo.carBrandsName);
                //大车牌号
                $("#carPNum").html(transitCarBaseinfo.carPlateNum);
                $("#carPhoto").attr("src",transitCarBaseinfo.carPhoto);


                var paramObj = "";
                var param = "cityId=130300";
                paramObj += "queryObj.carPlateNum=" + decodeURI(transitCarBaseinfo.carPlateNum);
                param += "&carPlateNum=" + decodeURI(transitCarBaseinfo.carPlateNum);
                paramObj += "&queryObj.carFrameNum=" + transitCarBaseinfo.carFrameNum;
                param += "&carFrameNum=" + transitCarBaseinfo.carFrameNum;

                //查询车辆的关联人员
                searchempByPlateNum(guangLianRenYuan);
                //查询车辆的长跑路线
                searchOftenRunRote(changPaoLuXian);
                //查询车辆的违章信息
                searchCarPeccancyRec(weiXianJiaShi);


                //里程分析
                mileageAnalysisData(transitCarBaseinfo.carPlateNum,transitCarBaseinfo.carFrameNum,dateFormat("yyyy-MM-dd",new Date()),"WEEK");
                //速度分析
                speedAnalysisData(transitCarBaseinfo.carPlateNum,transitCarBaseinfo.carFrameNum,dateFormat("yyyy-MM-dd",new Date()),"WEEK");

 }

//查询危险驾驶
function selctTime() {
    var currTime = $("#searchDate").val();
    //获取当前时间
    if(currTime!=''){
        var date1 = Format(currTime,'yyyyMM');
        var date2 = Format(currTime,'yyyyMMdd');
        var carPlateNum = $("#carPlateNum").html();
        debugger
        $.ajax({//http://localhost:8099/admin/bigdataAlarmRecord/selectAlarmRecordByCar.jsn
            url: basePathUrl +'/admin/bigdataAlarmRecord/selectAlarmRecordByCar.jsn',
            method:"post",
            data:{
                'queryObj.countMonth': date1,
                'queryObj.countDate' : date2,
                'queryObj.carPlateNum':carPlateNum
            },
            beforeSend: function (XMLHttpRequest) {
                XMLHttpRequest.setRequestHeader("access-token", getStorage("access_token"));
            },
            success:function (data) {//warningType

                searchCarPeccancyRec(data.data);

            }
        });
    }
}


function searchCarPeccancyRec(queryArgs){
    var html = "<tr>\n" +
        "                                            <!--<th style=\"width:15%\">司机</th>-->\n" +
        "                                            <th style=\"width:20%\">违章时间</th>\n" +
        "                                            <th style=\"width:15%\">司机</th>\n" +
        "                                            <th style=\"width:10%\">违章类型</th>\n" +
        "                                            <th style=\"width:10%\">报警速度</th>\n" +
        "                                            <th style=\"width:10%\">限速值</th>\n" +
        "                                            <th style=\"width:10%\">道路类型</th>\n" +
        "                                            <th style=\"width:15%\">处理结果</th>\n" +
        "                                            <!--<th style=\"width:20%\">详情</th>-->\n" +
        "                                          </tr>";
    if(queryArgs.length > 0){
        for(var i=0;i<queryArgs.length;i++){
            html += "<tr>";
            //html += "<td>" + peccancyData[i].driver + "</td>";
            html += "<td>" + queryArgs[i].createTime.substring(5,16) + "</td>";
            if(typeof (queryArgs[i].empName)=='undefined'){
                html += "<td>暂无</td>";
            }else {
                html += "<td>" + queryArgs[i].empName + "</td>";
            }
            if(queryArgs[i].alarmType=='2'){
                html += "<td><span class=\"wtg\">" + getAlarmType(queryArgs[i].alarmType) + "</span></td>";
                html += "<td><span>" + queryArgs[i].alarmSpeed + "</span></td>";
                html += "<td><span>" + queryArgs[i].roadSpeedLimit + "</span></td>";
            }else if(queryArgs[i].alarmType=='4'){
                html += "<td><span style='display: inline-block;\n" +
                    "    padding: 1px 2px;\n" +
                    "    background: #f47826;\n" +
                    "    border-radius: 2px;\n" +
                    "    color: #fff;\n" +
                    "    font-size: 12px;'>" + getAlarmType(queryArgs[i].alarmType) + "</span></td>";
                html += "<td><span></span></td>";
                html += "<td><span></span></td>";
            }else {
                html += "<td><span>" + getAlarmType(queryArgs[i].alarmType) + "</span></td>";
                html += "<td><span></span></td>";
                html += "<td><span></span></td>";
            }
            if(queryArgs[i].roadLevel==''){
                html += "<td><span>无</span></td>";
            }else {
                html += "<td><span>" + getRoadLevel(queryArgs[i].roadLevel) + "</span></td>";
            }
            html += "<td><span class=\"tg\">系统提醒</span></td>";
            //html += "<td><a href='###'>详情</a></td>";
            html += "</tr>";
        }
    }else{
        html += "<tr><td colspan='8'>暂无信息</td></tr>";
    }
    $("#peccancyList").html(html);
}




//道路等级
/*41000 高速公路,42000 国道,43000 主要大街、城市快速路,51000 省道,
44000 主要道路,45000  次要道路,52000 乡公路,53000 县乡村内部道路
54000 县乡村内部道路,47000 普通道路,49 非导航道路*/
function getRoadLevel(num) {
    if(num=='41000'){
        return "高速公路";
    }
    if(num=='42000'){
        return "国道";
    }
    if(num=='43000'){
        return "城市快速路";
    }
    if(num=='51000'){
        return "省道";
    }
    if(num=='44000'){
        return "主要道路";
    }
    if(num=='45000'){
        return "次要道路";
    }
    if(num=='52000'){
        return "乡公路";
    }
    if(num=='53000'){
        return "县乡村道路";
    }
    if(num=='54000'){
        return "县乡村道路";
    }
    if(num=='47000'){
        return "普通道路";
    }
    if(num=='49'){
        return "非导航道路";
    }
}


function getCarFunType(num){
    if(num=='1'){
        return "普通客车";
    }
    if(num=='2'){
        return "中级客车";
    }
    if(num=='3'){
        return "高一级客车";
    }
    if(num=='4'){
        return "高二级客车";
    }
    if(num=='5'){
        return "高三级客车";
    }
    if(num=='7'){
        return "普通货车";
    }
    if(num=='8'){
        return "集装箱车";
    }
    if(num=='9'){
        return "大件运输车";
    }
    if(num=='10'){
        return "冷藏保温车";
    }
    if(num=='11'){
        return "专用商品运输车";
    }
    if(num=='12'){
        return "罐车";
    }
    if(num=='13'){
        return "挂车";
    }
    if(num=='14'){
        return "平板车";
    }
    if(num=='15'){
        return "牵引车";
    }
    if(num=='16'){
        return "其他专用车";
    }
    if(num=='17'){
        return "农用车";
    }
    if(num=='18'){
        return "轮式拖拉机";
    }
    if(num=='19'){
        return "手扶拖拉机";
    }
    if(num=='20'){
        return "履带拖拉机";
    }
    if(num=='21'){
        return "特种拖拉机";
    }
    if(num=='22'){
        return "其它车辆";
    }
    if(num=='28'){
        return "出租车";
    }
    if(num=='29'){
        return "农用三轮车";
    }
}


function searchempByPlateNum(queryArgs){
    var html = "";
    if(queryArgs.length > 0){
        for(var i=0;i<queryArgs.length;i++){
            html += "<tr>";
            html += "<td><a href='#')>"+queryArgs[i].empName+"</a></td>";
            html += "<td>"+dateFormat("yyyy-MM-dd",new Date(queryArgs[i].createTime))+"</td>";
            html += "<td>驾驶员</td>";
            html += "</tr>";
        }
    }else{
        html += "<tr><td colspan='3'>暂无信息</td></tr>";
    }
    $("#empList").html($("#empList").html() + html);
}


function searchOftenRunRote(queryArgs){
    var html = "";
    if(queryArgs.length > 0){
        for(var i=0;i<queryArgs.length;i++){
            html += "<tr>";
            html += "<td><em class='ph40'>"+(i+1)+"</em></td>";
            html += "<td>"+queryArgs[i].runRoute+"</td>";
            html += "<td>"+queryArgs[i].runNum+"</td>";
            html += "</tr>";
        }
    }else{
        html += "<tr><td colspan='4'>暂无相关信息</td></tr>";
    }
    $("#tableId1").html($("#tableId1").html() + html);
}

//里程分析
function mileageAnalysisData(carPlateNum,carFrameNum,countTimeEnd,searchType){
    var param = "queryObj.carPlateNum="+carPlateNum + "&queryObj.carFrameNum=" + carFrameNum + "&queryObj.countTimeEnd=" + countTimeEnd;
    var dateArray = new Array();
    var dataArray = null;
    var lineNumber = 0;
    var circleCount = 7;
    var dateCur = new Date();
    //获取时间数组
    if(searchType == "MONTH"){
        dateCur = new Date();
        circleCount = new Date().getDate();
    }
    if(searchType == "PRE_MONTH"){
        circleCount = new Date(countTimeEnd).getDate();
        dateCur = new Date(countTimeEnd);
    }
    for(var i=0;i<circleCount;i++){
        var preDate = new Date(dateCur.getTime() - 24*60*60*1000*i);//获取前一天
        var dateStr = (preDate.getMonth()+1) +"月"+preDate.getDate()+"日";
        dateArray[circleCount-1-i] = dateStr;
    }
    param += "&searchCount="+circleCount;

    $.ajax({
        type:'POST',
        url: basePathUrl + '/admin/bigdataTimeCarDayRec/searchMileageByCarInfo.jsn',
        data:param,
        beforeSend: function (XMLHttpRequest) {
            XMLHttpRequest.setRequestHeader("access-token", getStorage("access_token"));
        },
        success:function(data){
            debugger
            dataArray = data.data;
            lineNumber = data.data[data.data.length-1];
            dataArray.splice(data.data.length-1,1);
            //里程分析
            mileageAnalysis(dateArray,dataArray,lineNumber);
            // if(data.success){
            //
            // }else {
            //     if(data.code==1001){
            //         location.href = '../../login.html';
            //     }else {
            //         debugger
            //         layer.msg('后台异常', {
            //             icon: 5
            //         });
            //     }
            // }
        }
    });
}

Date.prototype.format = function (fmt) {
    var o = {
        "M+": this.getMonth() + 1, //月份
        "d+": this.getDate(), //日
        "h+": this.getHours(), //小时
        "m+": this.getMinutes(), //分
        "s+": this.getSeconds(), //秒
        "q+": Math.floor((this.getMonth() + 3) / 3), //季度
        "S": this.getMilliseconds() //毫秒
    };
    if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
    for (var k in o)
        if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
    return fmt;
}
// 基于准备好的dom，初始化echarts实例 （里程分析）
function mileageAnalysis(dateArray,dataArray,lineNumber){
    var myChart = echarts.init(document.getElementById('aa1'));
    // 指定图表的配置项和数据
    option = {
        color: ['#3398DB'],
        tooltip : {
            trigger: 'axis',
            axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
            }
        },
        grid: {
            left: '3%',
            right: '5%',
            bottom: '3%',
            top:'13%',
            containLabel: true
        },
        xAxis : [
            {
                type : 'category',
                data : dateArray,
                axisTick: {
                    alignWithLabel: true
                },
                axisLine:{
                    lineStyle:{
                        color:'#21EDE8',
                        width:1,//这里是为了突出显示加上的
                    }
                }
            }
        ],
        yAxis : [
            {
                type : 'value',
                name : '公里',
                axisLine:{
                    lineStyle:{
                        color:'#21EDE8',
                        width:1,//这里是为了突出显示加上的
                    }
                },
                /*min: 0,
                max: 1000,*/
                splitLine: {
                    show: true,
                    lineStyle:{
                        color: ['#237d88'],
                        width: 1,
                        type: 'solid'
                    }

                },

            }
        ],

        series : [
            {
                name:'里程数',
                type:'bar',
                barWidth: '60%',
                markLine : {
                    itemStyle : {
                        normal: {
                            borderWidth:1,
                            lineStyle: {
                                type: 'symbol',
                                color:'#ff0000',
                                width:1
                            }}} ,
                    data : [
                        { name: '标线1起点', xAxis: 0, yAxis: lineNumber, symbol: 'circle'},
                        { name: '标线1终点', xAxis: '3月16日', yAxis: lineNumber, symbol: 'circle' },
                    ]
                },
                itemStyle: {
                    normal: {
                        color: "#E3B25A",
                        label: {
                            show: true, //开启显示
                            position: 'top', //在上方显示
                            textStyle: { //数值样式
                                color: '#fff',
                                fontSize: 16
                            }},

                        lineStyle: {
                            color: "#E3B25A"
                        }}
                },
                data:dataArray
            }
        ]
    };

    // 使用刚指定的配置项和数据显示图表。
    myChart.setOption(option);
}

//速度分析
function speedAnalysisData(carPlateNum,carFrameNum,countTimeEnd,searchType){
    var paramObj = "queryObj.carPlateNum="+carPlateNum+"&queryObj.carFrameNum="+carFrameNum+"&queryObj.countTimeEnd="+countTimeEnd;
    var dateArray = new Array();
    var dataArray = null;
    var lineNumber = 0;
    var circleCount = 7;
    var dateCur = new Date();
    //获取时间数组
    if(searchType == "MONTH"){
        dateCur = new Date();
        circleCount = new Date().getDate();
    }
    if(searchType == "PRE_MONTH"){
        circleCount = new Date(countTimeEnd).getDate();
        dateCur = new Date(countTimeEnd);
    }
    for(var i=0;i<circleCount;i++){
        var preDate = new Date(dateCur.getTime() - 24*60*60*1000*i);//获取前一天
        var dateStr = (preDate.getMonth()+1) +"月"+preDate.getDate()+"日";
        dateArray[circleCount-1-i] = dateStr;
    }
    paramObj += "&searchCount="+circleCount;

    $.ajax({
        type:'POST',
        url: basePathUrl + '/admin/bigdataTimeCarDayRec/searchSpeedByCarInfo.jsn',
        data:paramObj,
        beforeSend: function (XMLHttpRequest) {
            XMLHttpRequest.setRequestHeader("access-token", getStorage("access_token"));
        },
        success:function(data){
            debugger
            dataArray = data.data;
            lineNumber = data.data[data.data.length-1];
            dataArray.splice(data.data.length-1,1);
            speedAnalysis(dateArray,dataArray,lineNumber);
            // if(data.success){
            //
            // }else {
            //     if(data.code==1001){
            //         location.href = '../../login.html';
            //     }else {
            //         debugger
            //         layer.msg('后台异常', {
            //             icon: 5
            //         });
            //     }
            // }
        }
    });
}

function speedAnalysis(dateArray,dataArray,lineNumber){
    // 基于准备好的dom，初始化echarts实例 (速度分析)
    var myChart = echarts.init(document.getElementById('aa2'));
    // 指定图表的配置项和数据
    option = {
        color: ['#3398DB'],
        tooltip : {
            trigger: 'axis',
            axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
            }
        },
        grid: {
            left: '3%',
            right: '5%',
            bottom: '3%',
            top:'13%',
            containLabel: true
        },
        xAxis : [
            {
                type : 'category',
                data : dateArray,
                axisTick: {
                    alignWithLabel: true
                },
                axisLine:{
                    lineStyle:{
                        color:'#21EDE8',
                        width:1,//这里是为了突出显示加上的
                    }
                }
            }
        ],
        yAxis : [
            {
                type : 'value',
                name : '公里/小时',
                axisLine:{
                    lineStyle:{
                        color:'#21EDE8',
                        width:1,//这里是为了突出显示加上的
                    }
                },
                /*min: 0,
                max: 120,*/
                splitLine: {
                    show: true,
                    lineStyle:{
                        color: ['#237d88'],
                        width: 1,
                        type: 'solid'
                    }

                },

            }
        ],

        series : [
            {
                name:'平均速度',
                type:'bar',
                barWidth: '60%',
                markLine : {
                    itemStyle : {
                        normal: {
                            borderWidth:1,
                            lineStyle: {
                                type: 'symbol',
                                color:'#ff0000',
                                width:1
                            }}} ,
                    data : [
                        { name: '标线1起点', xAxis: 0, yAxis: lineNumber, symbol: 'circle'},
                        { name: '标线1终点', xAxis: '3月16日', yAxis: lineNumber, symbol: 'circle' },
                    ]
                },
                itemStyle: {
                    normal: {
                        color: "#3EC6CB",
                        label: {
                            show: true, //开启显示
                            position: 'top', //在上方显示
                            textStyle: { //数值样式
                                color: '#fff',
                                fontSize: 16
                            }},

                        lineStyle: {
                            color: "#3EC6CB"
                        }}
                },
                data:dataArray
            }
        ]
    };

    // 使用刚指定的配置项和数据显示图表。
    myChart.setOption(option);
}

function searchMonth(searchType,checkType){
    var carPlateNum = $("#carPlateNum").html();
    var carFrameNum = $("#carFrameNum").html();
    var countTimeEnd = dateFormat("yyyy-MM-dd",new Date());
    if(searchType == "MONTH"){
        var date = new Date();
        var d = new Date(date.getFullYear(),(date.getMonth()+1),0);
        var day = d.getDate();
        var countTimeEnd = dateFormat("yyyy-MM-dd",new Date());
        var searchType = "MONTH";
        if(checkType == "mileage"){
            //里程分析
            mileageAnalysisData(carPlateNum,carFrameNum,countTimeEnd,searchType);
        }
        if(checkType == "speed"){
            //速度分析
            speedAnalysisData(carPlateNum,carFrameNum,countTimeEnd,searchType);
        }
    }
    if(searchType == "PRE_MONTH"){
        var searchType = "PRE_MONTH";
        var countTimeEnd = dateFormat("yyyy-MM-dd",new Date());
        var date = new Date();
        var year = date.getFullYear();
        var month = date.getMonth();
        var day = 0;
        if(month == 0){
            year--;
            month = 12;
            var lastDate = new Date(year,month,0);
            countTimeEnd = dateFormat("yyyy-MM-dd",lastDate);
        }else{
            month--;
            var lastDate = new Date(year,(month+1),0);
            countTimeEnd = dateFormat("yyyy-MM-dd",lastDate);
        }
        if(checkType == "mileage"){
            //里程分析
            mileageAnalysisData(carPlateNum,carFrameNum,countTimeEnd,searchType);
        }
        if(checkType == "speed"){
            //速度分析
            speedAnalysisData(carPlateNum,carFrameNum,countTimeEnd,searchType);
        }
    }
    if(searchType == "WEEK"){
        var searchType = "WEEK";
        if(checkType == "mileage"){
            //里程分析
            mileageAnalysisData(carPlateNum,carFrameNum,countTimeEnd,searchType);
        }
        if(checkType == "speed"){
            //速度分析
            speedAnalysisData(carPlateNum,carFrameNum,countTimeEnd,searchType);
        }
    }
}

function getAlarmType(alarmType){
    if(alarmType == "1"){
        return "线路";
    }
    if(alarmType == "2"){
        return "超速";
    }
    if(alarmType == "3"){
        return "紧急";
    }
    if(alarmType == "4"){
        return "疲劳";
    }
}
</script>
    
    
    
<!--<script type="text/javascript">-->
<!--$(document).ready(function(){-->
	<!--// 下拉选择框-->
	<!--$('.dropdown-menu li').click(function(){-->
	  <!--var txt=$(this).text();-->
	  <!--$(this).parent().prev().find('span').eq(0).text(txt);-->
	<!--})-->

	<!--changeY();-->
	<!--$('.dropdown-menu li').click(function(){-->
		<!--var name=$('a',this).text();-->
		<!--$(this).parents('.btn-group').find('.dropdown-toggle span').text(name);-->
		<!--changeY();-->
	<!--})-->

	<!--function changeY(){-->
		<!--var year=$('#year').text().replace(/[^0-9]/ig,"")-->
		<!--var month=$('#month').text().replace(/[^0-9]/ig,"")-->
		<!--var days=totalDays(year, month);-->
		<!--var dayArr=[];-->
		<!--for(var i=1;i<=days;i++)-->
		<!--{-->
			<!--dayArr.push(i+'号');-->
		<!--}-->
		<!--var last=parseInt(dayArr[dayArr.length-1]);-->
		<!--$('.demo0').children().remove();-->
		<!--var div='<input type="hidden" value="" class="single-slider none">';-->
		<!--$('.demo0').html(div)-->
		<!--// -->
		<!--$('.single-slider').jRange({-->
		    <!--from:1,-->
		    <!--to:last,-->
		    <!--step: 1,-->
		    <!--scale: dayArr,-->
		    <!--format: '%s',-->
		    <!--width:850,-->
		    <!--showLabels: true,-->
		    <!--snap: true-->
		<!--});-->
	<!--}-->

	<!--//一个月的总天数-->
	<!--function totalDays(years,months){-->
		<!--var d = new Date(years, months, 0);-->
		<!--return d.getDate();-->
	<!--}-->
<!--})-->
<!--</script>-->

<script src="layer/layer.js"></script>
<script>
// 参数1 tableID,参数2 div高度，参数3 速度，参数4 tbody中tr几条以上滚动
tableScroll('tableId', 610, 30, 10)
tableScroll1('tableId1', 260, 30, 10)
var MyMarhq;
var MyMarhq1;

function tableScroll(tableid, hei, speed, len) {
    clearTimeout(MyMarhq);
    $('#' + tableid).parent().find('.tableid_').remove()
    $('#' + tableid).parent().prepend(
        '<table class="tableid_"><thead>' + $('#' + tableid + ' thead').html() + '</thead></table>'
    ).css({
        'position': 'relative',
        'overflow': 'hidden',
        'height': hei + 'px'
    })
//    $(".tableid_").find('th').each(function(i) {
//        $(this).css('width', $('#' + tableid).find('th:eq(' + i + ')').width());
//    });
    $(".tableid_").css({
        'position': 'absolute',
        'top': 0,
        'left': 0,
        'z-index': 9
    })
    $('#' + tableid).css({
        'position': 'absolute',
        'top': 0,
        'left': 0,
        'z-index': 1
    })

    if ($('#' + tableid).find('tbody tr').length > len) {
        $('#' + tableid).find('tbody').html($('#' + tableid).find('tbody').html() + $('#' + tableid).find('tbody').html());
        $(".tableid_").css('top', 0);
        $('#' + tableid).css('top', 0);
        var tblTop = 0;
        var outerHeight = $('#' + tableid).find('tbody').find("tr").outerHeight();

        function Marqueehq() {
            if (tblTop <= -outerHeight * $('#' + tableid).find('tbody').find("tr").length) {
                tblTop = 0;
            } else {
                tblTop -= 1;
            }
            $('#' + tableid).css('margin-top', tblTop + 'px');
            clearTimeout(MyMarhq);
            MyMarhq = setTimeout(function() {
                Marqueehq()
            }, speed);
        }

        MyMarhq = setTimeout(Marqueehq, speed);
        $('#' + tableid).find('tbody').hover(function() {
            clearTimeout(MyMarhq);
        }, function() {
            clearTimeout(MyMarhq);
            if ($('#' + tableid).find('tbody tr').length > len) {
                MyMarhq = setTimeout(Marqueehq, speed);
            }
        })
    }

}

function tableScroll1(tableid, hei, speed, len) {
    clearTimeout(MyMarhq1);
    $('#' + tableid).parent().find('.tableid_').remove()
    $('#' + tableid).parent().prepend(
        '<table class="tableid_"><thead>' + $('#' + tableid + ' thead').html() + '</thead></table>'
    ).css({
        'position': 'relative',
        'overflow': 'hidden',
        'height': hei + 'px'
    })
//    $(".tableid_").find('th').each(function(i) {
//        $(this).css('width', $('#' + tableid).find('th:eq(' + i + ')').width());
//    });
    $(".tableid_").css({
        'position': 'absolute',
        'top': 0,
        'left': 0,
        'z-index': 9
    })
    $('#' + tableid).css({
        'position': 'absolute',
        'top': 0,
        'left': 0,
        'z-index': 1
    })

    if ($('#' + tableid).find('tbody tr').length > len) {
        $('#' + tableid).find('tbody').html($('#' + tableid).find('tbody').html() + $('#' + tableid).find('tbody').html());
        $(".tableid_").css('top', 0);
        $('#' + tableid).css('top', 0);
        var tblTop = 0;
        var outerHeight = $('#' + tableid).find('tbody').find("tr").outerHeight();

        function Marqueehq() {
            if (tblTop <= -outerHeight * $('#' + tableid).find('tbody').find("tr").length) {
                tblTop = 0;
            } else {
                tblTop -= 1;
            }
            $('#' + tableid).css('margin-top', tblTop + 'px');
            clearTimeout(MyMarhq1);
            MyMarhq1 = setTimeout(function() {
                Marqueehq()
            }, speed);
        }

        MyMarhq1 = setTimeout(Marqueehq, speed);
        $('#' + tableid).find('tbody').hover(function() {
            clearTimeout(MyMarhq1);
        }, function() {
            clearTimeout(MyMarhq1);
            if ($('#' + tableid).find('tbody tr').length > len) {
                MyMarhq1 = setTimeout(Marqueehq, speed);
            }

        })
    }

}
</script>
    <script src="../../../../layuiadmin/layui/layui.js"></script>

<script>
    layui.use('laydate', function() {
        var laydate = layui.laydate;
        laydate.render({
            elem: '#searchDate'
        });
    });
</script>
</body>
</html>